<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>互評分配系統 (已連線)</title>
    
    <!-- 1. 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 2. 引入 Babel (讓瀏覽器能看懂 JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 3. 引入 Tailwind CSS (樣式庫) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* 隱藏數字輸入框的上下箭頭 */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-gray-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 您提供的 GAS 網址 (已預設填入) ---
        const DEFAULT_GAS_URL = "https://script.google.com/macros/s/AKfycbx8UT-qQRrtCfj2TJDb3vV1QZIcFM26mVRRUZIg_T3NzwC4QjxVJFwHr4PwYimHUATY/exec";

        // --- 圖示組件 ---
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Users: (props) => <Icon {...props} path={<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></>} />,
            User: (props) => <Icon {...props} path={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />,
            Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            Plus: (props) => <Icon {...props} path={<><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></>} />,
            RefreshCw: (props) => <Icon {...props} path={<><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></>} />,
            Save: (props) => <Icon {...props} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>} />,
            Link: (props) => <Icon {...props} path={<><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></>} />,
            AlertCircle: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></>} />,
            Calendar: (props) => <Icon {...props} path={<><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></>} />,
            CheckCircle2: (props) => <Icon {...props} path={<><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></>} />,
            Lock: (props) => <Icon {...props} path={<><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>} />,
            CloudUpload: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></>} />,
            Settings: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></>} />,
        };

        const PeerReviewApp = () => {
            // --- 狀態管理 ---
            const [activeTab, setActiveTab] = useState('roster');
            const [roster, setRoster] = useState([]);
            const [assignments, setAssignments] = useState(null);
            // 成績狀態 { "reviewerId-targetIndex": score }
            const [scores, setScores] = useState({}); 
            const [newStudent, setNewStudent] = useState({ no: '', name: '', url: '' });
            const [error, setError] = useState('');
            const [msg, setMsg] = useState({ type: '', text: '' });
            // 直接使用預設網址，不從 localStorage 讀取以免讀到舊的
            const [webhookUrl, setWebhookUrl] = useState(DEFAULT_GAS_URL);
            const [isUploading, setIsUploading] = useState(false);

            // --- 初始化與持久化 ---
            useEffect(() => {
                const savedRoster = localStorage.getItem('review_app_roster');
                const savedAssignments = localStorage.getItem('review_app_assignments');
                const savedScores = localStorage.getItem('review_app_scores');
                
                // 這裡我們不再從 localStorage 讀取 URL，強制使用代碼中設定好的 DEFAULT_GAS_URL
                // 這樣能確保您更新檔案後，一定會連到正確的後端

                if (savedRoster) setRoster(JSON.parse(savedRoster));
                if (savedAssignments) {
                    setAssignments(JSON.parse(savedAssignments));
                    setActiveTab('assignments');
                }
                if (savedScores) setScores(JSON.parse(savedScores));
            }, []);

            useEffect(() => localStorage.setItem('review_app_roster', JSON.stringify(roster)), [roster]);
            
            useEffect(() => {
                if (assignments) {
                    localStorage.setItem('review_app_assignments', JSON.stringify(assignments));
                } else {
                    localStorage.removeItem('review_app_assignments');
                }
            }, [assignments]);

            useEffect(() => localStorage.setItem('review_app_scores', JSON.stringify(scores)), [scores]);
            
            // --- 邏輯函數 ---
            const generateId = () => Date.now().toString(36) + Math.random().toString(36).substr(2);

            const verifyAdminPassword = (actionName) => {
                const password = prompt(`⚠️ 安全驗證\n\n請輸入管理員密碼以執行「${actionName}」：`);
                if (password === '0426') return true;
                if (password !== null) alert("❌ 密碼錯誤！操作已取消。");
                return false;
            };

            // 處理分數變更
            const handleScoreChange = (reviewerId, targetIdx, value) => {
                setScores(prev => ({
                    ...prev,
                    [`${reviewerId}-${targetIdx}`]: value
                }));
            };

            // 上傳到 Google Sheets
            const handleUploadToSheet = async () => {
                if (!assignments) return;
                if (!verifyAdminPassword('上傳成績到試算表')) return;

                let url = webhookUrl;
                if (!url) {
                    // 理論上不會執行到這裡，因為已經預設填入了
                    url = prompt("請輸入您的 Google Apps Script 網頁應用程式網址：");
                    if (!url) return;
                    setWebhookUrl(url);
                }

                setIsUploading(true);
                setMsg({ type: 'info', text: '⏳ 資料上傳中，請稍候...' });

                // 準備資料 payload
                const payload = {
                    password: '0426', // 傳送密碼給後端驗證
                    data: assignments.data.map(row => ({
                        reviewer: row.reviewer,
                        targets: row.targets,
                        scores: row.targets.map((_, idx) => scores[`${row.reviewer.id}-${idx}`] || '')
                    }))
                };

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        body: JSON.stringify(payload)
                    });
                    
                    const result = await response.json();
                    
                    if (result.status === 'success') {
                        setMsg({ type: 'success', text: result.message });
                    } else {
                        setMsg({ type: 'error', text: result.message || '上傳失敗' });
                    }
                } catch (err) {
                    console.error(err);
                    setMsg({ type: 'error', text: '❌ 連線失敗。請檢查 Apps Script 是否已部署為「執行身分：我」且「存取權：任何人」。' });
                } finally {
                    setIsUploading(false);
                    setTimeout(() => setMsg({ type: '', text: '' }), 5000);
                }
            };

            const handleResetUrl = () => {
                const newUrl = prompt('請輸入新的 Google Sheet 連線網址：', webhookUrl);
                if (newUrl) {
                    setWebhookUrl(newUrl);
                    alert('連線網址已更新。');
                }
            };

            const loadSampleData = () => {
                if (!verifyAdminPassword('載入範例資料')) return;
                const samples = Array.from({ length: 6 }, (_, i) => ({
                    id: generateId(),
                    no: String(i + 1).padStart(2, '0'),
                    name: `同學 ${String.fromCharCode(65 + i)}`, 
                    url: `https://example.com/work/${i + 1}`
                }));
                setRoster(samples);
                setAssignments(null);
                setScores({});
                setError('');
            };

            const handleClearRoster = () => {
                if (!verifyAdminPassword('清空名單')) return;
                if (confirm('確定要清空所有名單嗎？此動作無法復原。')) {
                    setRoster([]);
                    setScores({});
                }
            };

            const handleAddStudent = (e) => {
                e.preventDefault();
                if (!newStudent.no || !newStudent.name) {
                    setError('請填寫座號與姓名');
                    return;
                }
                setRoster([...roster, { ...newStudent, id: generateId() }]);
                setNewStudent({ no: '', name: '', url: '' });
                setError('');
            };

            const removeStudent = (id) => {
                setRoster(roster.filter(s => s.id !== id));
            };

            const shuffle = (array) => {
                const arr = [...array];
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                return arr;
            };

            const assignBalancedReviews = () => {
                if (!verifyAdminPassword('開始隨機分配')) return;
                const k = 3; 
                const n = roster.length;
                if (n < k + 1) {
                    setError(`名單人數不足。目前 ${n} 人，至少需要 ${k + 1} 人才能互評且不評自己。`);
                    return;
                }
                const indices = Array.from({ length: n }, (_, i) => i);
                const shuffledIndices = shuffle(indices);
                const S = shuffledIndices.map(idx => roster[idx]);
                const results = [];
                for (let i = 0; i < n; i++) {
                    const me = S[i];
                    const myTargets = [];
                    for (let step = 1; step <= k; step++) {
                        const targetIndex = (i + step) % n;
                        myTargets.push(S[targetIndex]);
                    }
                    results.push({ reviewer: me, targets: myTargets });
                }
                results.sort((a, b) => parseInt(a.reviewer.no) - parseInt(b.reviewer.no));
                const timestamp = new Date().toLocaleString('zh-TW', { hour12: false });
                setAssignments({ data: results, meta: { timestamp, creator: 'Web Admin' } });
                setScores({}); // 重置分數
                setActiveTab('assignments');
                setError('');
            };

            const resetAssignments = () => {
                if (!verifyAdminPassword('清除並重抽')) return;
                if (confirm('確定要清除目前的分配結果嗎？下次執行將會重新抽籤。')) {
                    setAssignments(null);
                    setScores({});
                    setActiveTab('roster');
                }
            };

            // --- Render ---
            return (
                <div className="min-h-screen bg-gray-50 p-4 font-sans text-slate-800 fade-in">
                    <div className="max-w-6xl mx-auto bg-white shadow-xl rounded-xl overflow-hidden">
                        
                        {/* Header */}
                        <div className="bg-blue-600 p-6 text-white flex justify-between items-center">
                            <div>
                                <h1 className="text-2xl font-bold flex items-center gap-2">
                                    <Icons.Users className="w-8 h-8" />
                                    互評分配系統
                                </h1>
                                <p className="text-blue-100 text-sm mt-1">平均分配 • 線上評分 • 雲端同步</p>
                            </div>
                            <div className="text-right text-xs text-blue-200 hidden sm:block">
                                <div className="flex items-center justify-end gap-1"><Icons.Lock className="w-3 h-3"/> Admin Protected</div>
                                <div className="flex items-center justify-end gap-1 text-green-300"><Icons.CloudUpload className="w-3 h-3"/> Connected to Google Sheet</div>
                            </div>
                        </div>

                        {/* Tabs */}
                        <div className="flex border-b border-gray-200">
                            <button onClick={() => setActiveTab('roster')} className={`flex-1 py-4 font-medium transition-colors ${activeTab === 'roster' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50' : 'text-gray-500 hover:bg-gray-50'}`}>
                                1. 學生名單
                            </button>
                            <button onClick={() => setActiveTab('assignments')} className={`flex-1 py-4 font-medium transition-colors ${activeTab === 'assignments' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50' : 'text-gray-500 hover:bg-gray-50'}`}>
                                2. 分配與評分
                            </button>
                        </div>

                        <div className="p-6">
                            {/* 全域訊息提示 */}
                            {msg.text && (
                                <div className={`mb-4 p-3 rounded flex items-center gap-2 text-sm font-bold ${msg.type === 'error' ? 'bg-red-100 text-red-700' : msg.type === 'success' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}`}>
                                    {msg.type === 'error' ? <Icons.AlertCircle className="w-5 h-5" /> : <Icons.CheckCircle2 className="w-5 h-5" />}
                                    {msg.text}
                                </div>
                            )}
                            
                            {error && (
                                <div className="mb-6 p-4 bg-red-50 border-l-4 border-red-500 text-red-700 flex items-center gap-2 rounded-r">
                                    <Icons.AlertCircle className="w-5 h-5" />
                                    {error}
                                </div>
                            )}

                            {/* --- ROSTER TAB --- */}
                            {activeTab === 'roster' && (
                                <div className="space-y-6 fade-in">
                                    <div className="flex justify-between items-center">
                                        <h2 className="text-lg font-semibold text-gray-700">目前名單 ({roster.length} 人)</h2>
                                        <div className="flex gap-2">
                                            <button onClick={loadSampleData} className="px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded border border-gray-300 flex items-center gap-1" title="需要密碼"><Icons.Lock className="w-3 h-3 mr-1"/><Icons.Save className="w-4 h-4"/> 範例</button>
                                            <button onClick={handleClearRoster} className="px-3 py-1.5 text-sm bg-red-50 hover:bg-red-100 text-red-600 rounded border border-red-200 flex items-center gap-1" title="需要密碼"><Icons.Lock className="w-3 h-3 mr-1"/><Icons.Trash2 className="w-4 h-4"/> 清空</button>
                                        </div>
                                    </div>

                                    <form onSubmit={handleAddStudent} className="bg-gray-50 p-4 rounded-lg border border-gray-200 grid grid-cols-1 sm:grid-cols-12 gap-3 items-end">
                                        <div className="sm:col-span-2"><label className="text-xs font-medium text-gray-500">座號</label><input type="text" placeholder="01" className="w-full p-2 border rounded" value={newStudent.no} onChange={e => setNewStudent({...newStudent, no: e.target.value})} /></div>
                                        <div className="sm:col-span-3"><label className="text-xs font-medium text-gray-500">姓名</label><input type="text" placeholder="姓名" className="w-full p-2 border rounded" value={newStudent.name} onChange={e => setNewStudent({...newStudent, name: e.target.value})} /></div>
                                        <div className="sm:col-span-5"><label className="text-xs font-medium text-gray-500">作品網址</label><input type="text" placeholder="https://..." className="w-full p-2 border rounded" value={newStudent.url} onChange={e => setNewStudent({...newStudent, url: e.target.value})} /></div>
                                        <div className="sm:col-span-2"><button type="submit" className="w-full bg-blue-600 hover:bg-blue-700 text-white p-2 rounded flex justify-center items-center gap-1"><Icons.Plus className="w-4 h-4" /> 新增</button></div>
                                    </form>

                                    <div className="border rounded-lg overflow-hidden">
                                        <table className="w-full text-left text-sm">
                                            <thead className="bg-gray-100 text-gray-600 uppercase font-semibold">
                                                <tr><th className="p-3 w-20">座號</th><th className="p-3 w-32">姓名</th><th className="p-3">作品網址</th><th className="p-3 w-20 text-center">操作</th></tr>
                                            </thead>
                                            <tbody className="divide-y divide-gray-200 bg-white">
                                                {roster.length === 0 ? (<tr><td colSpan="4" className="p-8 text-center text-gray-400">無資料</td></tr>) : roster.map(s => (
                                                    <tr key={s.id} className="hover:bg-gray-50"><td className="p-3 font-medium">{s.no}</td><td className="p-3">{s.name}</td><td className="p-3 text-blue-600 truncate max-w-xs">{s.url ? <a href={s.url} target="_blank" className="flex items-center gap-1 hover:underline"><Icons.Link className="w-3 h-3"/>連結</a> : '-'}</td><td className="p-3 text-center"><button onClick={() => removeStudent(s.id)} className="text-gray-400 hover:text-red-500"><Icons.Trash2 className="w-4 h-4 mx-auto"/></button></td></tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <div className="flex justify-end mt-4">
                                        <button onClick={assignBalancedReviews} disabled={roster.length < 4 || assignments !== null} className={`px-6 py-3 rounded-lg font-bold shadow-md flex items-center gap-2 ${assignments !== null ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : roster.length < 4 ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700 text-white'}`}>
                                            {assignments ? <><Icons.CheckCircle2 className="w-5 h-5" /> 已產生分配</> : <><Icons.Lock className="w-4 h-4 mr-1"/><Icons.RefreshCw className="w-5 h-5" /> 開始隨機分配</>}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* --- ASSIGNMENTS TAB --- */}
                            {activeTab === 'assignments' && (
                                <div className="space-y-6 fade-in">
                                    {!assignments ? (
                                        <div className="text-center py-16 bg-gray-50 border-2 border-dashed border-gray-200 rounded-lg">
                                            <Icons.Users className="w-12 h-12 text-gray-300 mx-auto mb-2" />
                                            <p className="text-gray-500 mb-4">尚未產生分配結果</p>
                                            <button onClick={() => setActiveTab('roster')} className="text-blue-600 hover:underline">← 返回名單管理</button>
                                        </div>
                                    ) : (
                                        <>
                                            <div className="bg-blue-50 border border-blue-100 rounded-lg p-4 flex flex-col md:flex-row justify-between items-center gap-4">
                                                <div>
                                                    <div className="flex items-center gap-2 text-blue-800 font-bold mb-1"><Icons.CheckCircle2 className="w-5 h-5 text-green-600" /> 分配完成！請輸入分數並上傳。</div>
                                                    <div className="text-xs text-blue-600 flex gap-4">
                                                        <span className="flex items-center gap-1"><Icons.Calendar className="w-3 h-3" /> {assignments.meta.timestamp}</span>
                                                    </div>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button onClick={handleResetUrl} className="px-3 py-2 text-xs text-gray-500 hover:text-gray-700 border border-transparent hover:border-gray-300 rounded flex items-center gap-1" title="修改 Google Sheet 連線網址">
                                                        <Icons.Settings className="w-4 h-4" /> 修改連線
                                                    </button>
                                                    
                                                    <button onClick={handleUploadToSheet} disabled={isUploading} className={`px-4 py-2 font-bold text-white rounded shadow-sm flex items-center gap-2 transition-colors ${isUploading ? 'bg-gray-400 cursor-wait' : 'bg-indigo-600 hover:bg-indigo-700'}`}>
                                                        {isUploading ? '上傳中...' : <><Icons.Lock className="w-3 h-3 mr-1"/><Icons.CloudUpload className="w-4 h-4" /> 上傳成績至試算表</>}
                                                    </button>
                                                    <button onClick={resetAssignments} className="px-4 py-2 bg-white border border-gray-300 text-gray-700 font-medium rounded hover:text-red-600 flex items-center gap-2 shadow-sm" title="需要密碼">
                                                        <Icons.Lock className="w-3 h-3 mr-1"/><Icons.RefreshCw className="w-4 h-4" /> 重抽
                                                    </button>
                                                </div>
                                            </div>

                                            <div className="overflow-x-auto border rounded-lg shadow-sm">
                                                <table className="w-full text-sm text-left whitespace-nowrap">
                                                    <thead className="bg-gray-800 text-gray-100">
                                                        <tr>
                                                            <th className="p-3 w-16 border-r border-gray-700 sticky left-0 bg-gray-800 z-10">座號</th>
                                                            <th className="p-3 w-24 border-r border-gray-700 sticky left-16 bg-gray-800 z-10">評審</th>
                                                            {[1, 2, 3].map(n => (
                                                                <th key={n} className="p-3 text-center border-r border-gray-600 bg-gray-700" colSpan="3">
                                                                    被評對象 #{n}
                                                                </th>
                                                            ))}
                                                        </tr>
                                                        <tr className="bg-gray-700 text-xs text-gray-300">
                                                            <th className="p-1 border-r border-gray-600 sticky left-0 bg-gray-700"></th>
                                                            <th className="p-1 border-r border-gray-600 sticky left-16 bg-gray-700"></th>
                                                            {[1, 2, 3].map(n => (
                                                                <React.Fragment key={n}>
                                                                    <th className="p-1 w-20 pl-2">姓名</th>
                                                                    <th className="p-1 w-10 text-center">連結</th>
                                                                    <th className="p-1 w-16 text-center border-r border-gray-600 bg-yellow-900/30 text-yellow-200">分數</th>
                                                                </React.Fragment>
                                                            ))}
                                                        </tr>
                                                    </thead>
                                                    <tbody className="bg-white divide-y divide-gray-200">
                                                        {assignments.data.map((row, idx) => (
                                                            <tr key={idx} className="hover:bg-gray-50">
                                                                <td className="p-3 font-bold text-gray-900 border-r sticky left-0 bg-white">{row.reviewer.no}</td>
                                                                <td className="p-3 text-gray-800 border-r font-medium sticky left-16 bg-white">{row.reviewer.name}</td>
                                                                
                                                                {row.targets.map((t, tIdx) => (
                                                                    <React.Fragment key={tIdx}>
                                                                        <td className="p-2 pl-3 text-gray-700 text-xs">
                                                                            <span className="inline-block w-4 text-gray-400 mr-1">{t.no}</span>
                                                                            {t.name}
                                                                        </td>
                                                                        <td className="p-2 text-center">
                                                                            {t.url ? <a href={t.url} target="_blank" title="查看作品" className="text-blue-600 hover:text-blue-800 inline-block p-1 hover:bg-blue-50 rounded"><Icons.Link className="w-4 h-4" /></a> : <span className="text-gray-300">-</span>}
                                                                        </td>
                                                                        <td className={`p-1 border-r ${tIdx===2?'':'border-gray-200'} bg-yellow-50/50`}>
                                                                            <input 
                                                                                type="number" 
                                                                                min="0" max="100" 
                                                                                placeholder="-"
                                                                                className="w-full p-1 text-center border border-gray-200 rounded focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none text-sm font-bold text-blue-800 bg-white"
                                                                                value={scores[`${row.reviewer.id}-${tIdx}`] || ''}
                                                                                onChange={(e) => handleScoreChange(row.reviewer.id, tIdx, e.target.value)}
                                                                            />
                                                                        </td>
                                                                    </React.Fragment>
                                                                ))}
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PeerReviewApp />);
    </script>
</body>
</html>
